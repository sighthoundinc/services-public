# On-Demand Analytics REST API Sample

## Summary

This sample implements a REST API based analytics, allowing monitoring of an RTSP stream, and retrieving a most-recent image with associated analytics, as well as providing an inline image for analytics.

## Implementation

This sample is backed by two separate pipelines, executing within the same process. One pipeline is responsible for monitoring an RTSP stream, and emitting it's output to a shared storage volume, as well as maintaining the lifecycle of that output. The output is generated and managed with an extension module.

The other pipeline is a vanilla Folder Watch pipeline.

REST API Flask module is bringing it all together, providing a front-end implementation of the API. Upon request for an analytics, it finds the most recent file generated by the live pipeline, and serves JSON containing the image and relevant analytics. Another flavor of that API will serve an image/jpg, which is useful for debugging.

## Client

A sample client is implemented in `SIOOnDemandAnalytics/clients/OnDemandTest.py`.
The client can be ran using `python3 ./clients/OnDemandTest.py [-i inputImage] [-o outputFolder]`

## OS Compatibility

`SIO_DOCKER_TAG_VARIANT` environment variable used in `docker-compose` controls the flavor of SIO analytics container image. While on x86 systems thing largely work without setting it, on Jetson-based system, set it to the value most compatible with your base OS.

* `-r32.4.3-arm64v8` (built for hardware running Jetpack 4.4)
* `-r32.7.3-arm64v8` (built for hardware running Jetpack 4.6)
* `-r35.3.1-arm64v8` (work in progress, built for hardware running Jetpack 5.1)
* `-amd64` for x86 based systems

